<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>有关VPN在VPS上的配置</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

        <!-- Personal CSS -->
        <link rel="stylesheet" href="/css/personal.css">
    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">K.I.S.S</a></h1>
              <a class="extra" href="/">home</a>
              <a class="extra" href="/about.html">about</a>
              <a class="extra" href="/atom.xml">RSS</a>
            </div>

                

<h2>有关VPN在VPS上的配置</h2>

<p class="meta">04 Apr 2012</p>

<div class="post">
  <p>
简单记载一下VPN在VPS的配置经过:
</p>
<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">安装pptpd，具体根据发行版。</h3>
<div class="outline-text-3" id="text-1">


</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">编辑/etc/pptpd.conf</h3>
<div class="outline-text-3" id="text-2">

<p>去掉#的注释
option /etc/ppp/pptpd-options
localip 192.168.0.1
remoteip 192.168.0.234-238,192.168.0.245
</p>
</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">编辑 /etc/ppp/pptpd-options 文件，设置 DNS</h3>
<div class="outline-text-3" id="text-3">

<p>找到 ms-dns 去掉 # 号，并修改 DNS 地址
</p>
<p>
ms-dns 8.8.8.8
ms-dns 8.8.4.4
</p>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4">编辑 /etc/ppp/chap-secrets ，加入用户</h3>
<div class="outline-text-3" id="text-4">


<p>
用户名 pptpd 密码 *
</p>
</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5">编辑 /etc/sysctl.conf 文件，找到以下行，去掉 # 号注释符号</h3>
<div class="outline-text-3" id="text-5">


<p>
net.ipv4.ip<sub>forward</sub>=1
</p>
<p>
然后在运行以下命令使配置生效
</p>
<p>
sysctl -p
</p>
</div>

</div>

<div id="outline-container-6" class="outline-3">
<h3 id="sec-6">向 nat 表中添加一条规则，如果没有iptables记得安装:</h3>
<div class="outline-text-3" id="text-6">


<p>
iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j
MASQUERADE
</p>
</div>

</div>

<div id="outline-container-7" class="outline-3">
<h3 id="sec-7">保存状态，免得重启无效</h3>
<div class="outline-text-3" id="text-7">

<p>iptables-save &gt; /etc/iptables-rules
</p>
<p>
然后修改 /etc/network/interfaces 文件，找到 venet0 的结点，添加 pre-up 那一行：
auto venet0
iface venet0 inet static
pre-up iptables-restore &lt; /etc/iptables-rules
</p>
</div>

</div>

<div id="outline-container-8" class="outline-3">
<h3 id="sec-8">手动处理的情况</h3>
<div class="outline-text-3" id="text-8">


<p>
iptables-restore /etc/iptables-rules
</p>
</div>

</div>

<div id="outline-container-9" class="outline-3">
<h3 id="sec-9">参考</h3>
<div class="outline-text-3" id="text-9">

<ul>
<li><a href="http://blog.jkey.lu/install-pptp-on-ubuntu/">http://blog.jkey.lu/install-pptp-on-ubuntu/</a>
</li>
<li><a href="http://wangyan.org/blog/debian-pptp-vpn.html">http://wangyan.org/blog/debian-pptp-vpn.html</a>
</li>
</ul>





</div>
</div>

  <div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
  
  var disqus_developer = 1;
  
  var disqus_shortname = 'qinjian623-blogger';
  // required    : replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>  

  </div>
</div>


            <div class="footer">
            </div>
          </div>
        </div> <!-- /container -->

        <footer class="footer">
          <p>&copy; Qin Jian 2012 如无特殊说明,所有产生内容默认<a href="http://creativecommons.org/licenses/by-sa/2.5/cn">CC知识共享署名-相同方式</a>
          </p>
        </footer>
        
         <script type="text/javascript">
   var _gaq = _gaq || [];
   _gaq.push(['_setAccount', 'UA-34189274-1']);
   _gaq.push(['_trackPageview']);

   (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();
 </script>    

    </body>
</html>
